#單向資料流 #renderer 

# 單向資料流

## 什麼是單向資料流
單向資料流是一個在現代框架及Library 常見的設計模式，他被應用在 React、Vue、Angular中。資料傳遞是透過`單一方向`至不同元件、層級，且不可逆。

資料從父層傳遞至子層，但子層無法改變父層的資料。

在前端的應用，畫面是資料透過模板及渲染邏輯所產生，也就是所謂的==資料驅動畫面==。

> ONLY ! 畫面只會因為資料變動才會更新！

![資料流](./images/2-6-1.png)

## 資料與畫面分離

將==資料管理==與==畫面渲染==分開處理並各自定義是實踐單向資料流的重要前提，也就是「資料與畫面的分離管理」。

> 實現單向資料流的策略：：
> **資料與畫面分離，且維持單一的資料來源**

### 比較資料分離
| 管理方式      | 定義                         |
| --------- | -------------------------- |
| 不獨立定義原始資料 | 直接操作 DOM element ，實現使用者的行為 |
| 資料與畫面分離   | 更新原始資料，畫面透過資料產生變化          |

### 單一資料來源 (single source of truth)
- 單向資料流往往伴隨著`單一資料來源`此概念
- 只有源頭的資料，才是畫面的來源
- 同一個概念的資料不應該出現在應用程式多處

## 限縮變因的價值

> **ONLY ! 畫面只會因為資料變動才會更新！**

1. 可預測性 (Predictability)
		- 因為資料的單向性，可以更簡單的資料如何傳遞
2. 可維護性(Maintainability)、可讀性
		- 資料源頭被嚴格的控制
3. 效能優化 (Performance)
		- 可以知道哪些元件是依賴那些資料，這使得能進行有效的效能優化，如不必要的重新渲染

## 單向資料流渲染策略
>！！在單向資料流的概念中，畫面是資料流的延伸

### 手動更新特定 DOM
*當資料更新後，以人工判斷並手動修改連動的 DOM element*

優點：操作如果很精準，可以避免效能的浪費
缺點：純靠人為維護上很容易出錯

[範例](https://w6ddxy.csb.app/)
### 一律重新繪製
*更新資料後，完全不需要知道具體資料連動的 DOM element*

優點：只要管資料跟模板就好
缺點：會有多餘不必較的 DOM 操作，而耗效能

[範例](https://8jcfdq.csb.app/)


### 前端框架處理策略

資料更新後的畫面連動更新是前端應用程式重要的挑戰，而框架會採用不同上述渲染策略並透過一些設計，解決缺點保留優點。

Vue 採用策略ㄧ的模式，而透過資料與模板的綁定，監聽資料變化，自動找到資料變化相關的 DOM 避免策略一手動更新的大缺點。

而 React 採用 一律重繪的策略，透過重繪 Virtual DOM 解決效能缺點。

## React中的一律重繪渲染策略

React element 是基於 Virtual DOM 概念所實踐的虛擬畫面資料結構，它是模擬實際的 DOM。

程式依據 Virtual DOM 的比較操作實際的 DOM，使 Virtual DOM 與實際 DOM 保持一至，而同步的過程是單向，從 Virtual DOM => DOM。

而每一次的資料更新，React 就會產生新的 Virtual DOM 並作比較，接著依據差異操作 DOM。

>資料更新 => 重新繪製 Virtual DOM => 比較新舊 => 差異繪製

回歸重繪機制， React 選擇一律重繪虛擬的畫面結構資料，解決無意義操作 DOM 效能問題。


### React render
- 產生 React element的流程

### React re-render
- 一律重繪渲染價值發揮之處
- 以新的原始資料產生新的 React element

